---
root: true

extends:
  - eslint:recommended
  - plugin:import/typescript
  - eslint-config-shakacode
  - prettier

globals:
  __DEBUG_SERVER_ERRORS__: writable
  __SERVER_ERRORS__: writable

parserOptions:
  # We have @babel/eslint-parser from eslint-config-shakacode, but don't use Babel in the main project
  requireConfigFile: false

plugins:
  - jest
  - prettier
env:
  browser: true
  node: true
  jest: true

settings:
  import/extensions: [".js", ".ts"]
  import/parsers:
    "@typescript-eslint/parser": [".ts"]
  import/resolver:
    node: true
    typescript: true

rules:
  no-console: 0
  no-void:
    - error
    # Allow using void to suppress errors about misused promises
    - { allowAsStatement: true }
  # The reason for disabling for-of loops doesn't apply to Node
  no-restricted-syntax: off

  # https://github.com/benmosher/eslint-plugin-import/issues/340
  import/no-extraneous-dependencies: 0

  jest/no-disabled-tests: "warn"
  jest/no-focused-tests: "error"
  jest/no-identical-title: "error"
  jest/prefer-to-have-length: "warn"
  jest/valid-expect: "error"
  import/extensions: "off"
  import/prefer-default-export: "off"

  # incompatible with prettier
  lines-between-class-members: off
  no-mixed-operators: 0

overrides:
  - files: "**/*.ts{x,}"
    parser: "@typescript-eslint/parser"
    parserOptions:
      project: true
    plugins:
      - "@typescript-eslint"
    extends:
      - plugin:@typescript-eslint/strict-type-checked
    rules:
      "@typescript-eslint/restrict-template-expressions": off
      "@typescript-eslint/no-unused-vars":
        - error
        - { argsIgnorePattern: "^_" }
      "@typescript-eslint/no-floating-promises":
        - error
        - allowForKnownSafePromises:
            - { from: "package", package: "fastify", name: "FastifyReply" }
  - files: "packages/node-renderer/tests/**"
    rules:
      # Allows Jest mocks before import
      import/first: off
  - files: "k6/**/*.{js,ts}"
    globals:
      # See https://github.com/grafana/k6-docs/blob/65d9f8a9a53f57a4f416763f8020d0c7f40eb976/docs/sources/.eslintrc.js
      __ENV: readonly
      __VU: readonly
      __ITER: readonly
      console: readonly
      open: readonly
      window: readonly
      setInterval: readonly
      clearInterval: readonly
      setTimeout: readonly
      clearTimeout: readonly
    rules:
      "import/extensions":
        - error
        - ignorePackages
      "import/no-unresolved":
        - error
        - { ignore: ["k6.*"] }
