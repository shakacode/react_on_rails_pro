set -e

#!/bin/bash

# Function to cleanup background processes
cleanup() {
    echo "Cleaning up..."
    if [ ! -z "$RAILS_PID" ]; then
        echo "Stopping Rails server (PID: $RAILS_PID)"
        kill $RAILS_PID 2>/dev/null
    fi
    cd ../..
    exit 0
}

# Set trap to cleanup on script exit
trap cleanup EXIT INT TERM

bundle && yarn

cd spec/dummy

rm -f client/app/generated/server-bundle-generated.js

rake react_on_rails:generate_packs

bundle && yarn

yarn build:test

# RAILS_ENV=test rails s &
# RAILS_PID=$!

# NODE_ENV=test node client/node-renderer.js
